<Window x:Class="berles2.FinancialDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:berles2"
        mc:Ignorable="d"
        Title="Pénzügyi tétel hozzáadása/szerkesztése" Height="500" Width="450"
        WindowStartupLocation="CenterOwner" ResizeMode="CanResize">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- CÍMSOR -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,20">
            <TextBlock Text="💰" FontSize="24" Margin="0,0,10,0" VerticalAlignment="Center"/>
            <TextBlock x:Name="TitleTextBlock" Text="Új pénzügyi tétel hozzáadása" 
                      FontSize="18" FontWeight="Bold" VerticalAlignment="Center" Foreground="#2E7D32"/>
        </StackPanel>

        <!-- ŰRLAP -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <StackPanel Margin="10">

                <!-- DÁTUM -->
                <Label Content="Dátum:" FontWeight="Bold"/>
                <DatePicker x:Name="DatePicker" Height="30" Margin="0,0,0,15"/>

                <!-- TÍPUS -->
                <Label Content="Típus:" FontWeight="Bold"/>
                <ComboBox x:Name="EntryTypeComboBox" Height="30" Margin="0,0,0,15"
                         SelectionChanged="EntryTypeComboBox_SelectionChanged">
                    <ComboBoxItem Content="bevétel" IsSelected="True"/>
                    <ComboBoxItem Content="költség"/>
                </ComboBox>

                <!-- FORRÁS TÍPUS -->
                <Label Content="Forrás típus:" FontWeight="Bold"/>
                <ComboBox x:Name="SourceTypeComboBox" Height="30" Margin="0,0,0,15">
                    <ComboBoxItem Content="kézi" IsSelected="True"/>
                    <ComboBoxItem Content="alkatrész"/>
                    <ComboBoxItem Content="javítás"/>
                    <ComboBoxItem Content="egyéb"/>
                </ComboBox>

                <!-- JEGY SZÁM -->
                <Label Content="Jegy szám:" FontWeight="Bold"/>
                <TextBox x:Name="TicketNumberTextBox" Height="30" Margin="0,0,0,15"/>

                <!-- ÖSSZEG -->
                <Label Content="Összeg (Ft):" FontWeight="Bold"/>
                <TextBox x:Name="AmountTextBox" Height="30" Margin="0,0,0,15"
                        TextAlignment="Right" PreviewTextInput="AmountTextBox_PreviewTextInput"
                        Text="0"/>

                <!-- ÖSSZEG ELŐNÉZET -->
                <Border x:Name="AmountPreviewBorder" Height="40" Margin="0,0,0,15"
                       BorderThickness="2" CornerRadius="5" Padding="10"
                       Background="#F0F8FF" BorderBrush="#4CAF50">
                    <TextBlock x:Name="AmountPreviewText" Text="0 Ft" 
                              FontSize="16" FontWeight="Bold" 
                              HorizontalAlignment="Center" VerticalAlignment="Center"
                              Foreground="#4CAF50"/>
                </Border>

                <!-- MEGJEGYZÉS -->
                <Label Content="Megjegyzés:" FontWeight="Bold"/>
                <TextBox x:Name="CommentTextBox" Height="80" Margin="0,0,0,15"
                        TextWrapping="Wrap" AcceptsReturn="True" 
                        VerticalScrollBarVisibility="Auto"/>
                <!-- ESZKÖZÖK VÁLASZTÁSA -->
                <Label Content="Kapcsolódó eszközök:" FontWeight="Bold"/>
                <Border BorderThickness="1" BorderBrush="Gray" Height="120" Margin="0,0,0,15">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="30"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- KERESÉS -->
                        <TextBox x:Name="DeviceSearchTextBox" Grid.Row="0" 
                Height="28" Margin="5" VerticalContentAlignment="Center"
                TextChanged="DeviceSearchTextBox_TextChanged"/>

                        <!-- ESZKÖZLISTA -->
                        <ListBox x:Name="DevicesListBox" Grid.Row="1" 
                Margin="5" SelectionMode="Multiple"
                SelectionChanged="DevicesListBox_SelectionChanged">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <StackPanel.Style>
                                            <Style TargetType="StackPanel">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding Available}" Value="False">
                                                        <Setter Property="Background" Value="#FFEEEE"/>
                                                        <Setter Property="Opacity" Value="0.7"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </StackPanel.Style>
                                        <CheckBox x:Name="DeviceCheckBox" 
             IsChecked="{Binding IsSelected}" 
             Margin="0,0,10,0"/>
                                        <TextBlock Text="{Binding DeviceName}" FontWeight="Bold" Margin="0,0,10,0">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Available}" Value="False">
                                                            <Setter Property="Foreground" Value="Red"/>
                                                            <Setter Property="TextDecorations" Value="Strikethrough"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                        <TextBlock Text="{Binding Serial}" Foreground="Gray" Margin="0,0,10,0"/>
                                        <TextBlock Text="{Binding DeviceTypeNavigation.TypeName}" 
              Foreground="Blue" FontStyle="Italic" Margin="0,0,10,0"/>
                                        <TextBlock Text="{Binding Available, StringFormat='{}{0}'}" Margin="0,0,10,0">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Available}" Value="True">
                                                            <Setter Property="Text" Value="✓ Elérhető"/>
                                                            <Setter Property="Foreground" Value="Green"/>
                                                            <Setter Property="FontWeight" Value="Bold"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Available}" Value="False">
                                                            <Setter Property="Text" Value="✗ Nem elérhető"/>
                                                            <Setter Property="Foreground" Value="Red"/>
                                                            <Setter Property="FontWeight" Value="Bold"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                    </StackPanel>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </Grid>
                </Border>

                <!-- KIVÁLASZTOTT ESZKÖZÖK MEGJELENÍTÉSE -->
                <Border x:Name="SelectedDevicesBorder" BorderThickness="1" BorderBrush="Green" 
       Background="#F0FFF0" Padding="10" Margin="0,0,0,15"
       Visibility="Collapsed">
                    <StackPanel>
                        <TextBlock Text="Kiválasztott eszközök:" FontWeight="Bold" 
                  Foreground="Green" Margin="0,0,0,5"/>
                        <TextBlock x:Name="SelectedDevicesText" Text="" 
                  Foreground="DarkGreen" TextWrapping="Wrap"/>
                    </StackPanel>
                </Border>

                <TextBlock Text="Kötelező mezők: dátum, összeg, megjegyzés" FontSize="12" 
                          Foreground="Blue" FontStyle="Italic" Margin="0,10,0,0"/>
            </StackPanel>
        </ScrollViewer>

        <!-- GOMBOK -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" 
                   HorizontalAlignment="Right" Margin="0,20,0,0">
            <Button x:Name="SaveButton" Content="Mentés" 
                    Width="100" Height="35" Margin="0,0,10,0"
                    Background="#4CAF50" Foreground="White" FontWeight="Bold"
                    Click="SaveButton_Click"/>

            <Button x:Name="CancelButton" Content="Mégsem" 
                    Width="100" Height="35"
                    Background="#757575" Foreground="White" FontWeight="Bold"
                    Click="CancelButton_Click"/>
        </StackPanel>
    </Grid>
</Window>